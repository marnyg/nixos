#!/usr/bin/env bash
# shellcheck shell=bash

# Source local overrides if they exist
source_env_if_exists .envrc.local

# Install devenv CLI to PATH if not already available
if ! command -v devenv &>/dev/null; then
  # shellcheck disable=SC2016
  DEVENV_PATH=$(nix-shell -p devenv --run 'echo $PATH' 2>/dev/null)
  export PATH="${DEVENV_PATH}:$PATH"
fi

# Use devenv if devenv.nix exists, otherwise fall back to flake
if [ -f "devenv.nix" ]; then
  # Use devenv shell
  eval "$(devenv print-dev-env)"
else
  # Fall back to flake
  use flake . --no-pure-eval --fallback
fi
